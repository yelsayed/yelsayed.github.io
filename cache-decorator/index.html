<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.f4b697f82fab86251be3.css" id="gatsby-global-css">@import url(https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&display=swap);@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}


/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden]{display:none}:root{--maxWidth-none:"none";--maxWidth-xs:20rem;--maxWidth-sm:24rem;--maxWidth-md:28rem;--maxWidth-lg:32rem;--maxWidth-xl:36rem;--maxWidth-2xl:42rem;--maxWidth-3xl:48rem;--maxWidth-4xl:56rem;--maxWidth-5xl:75rem;--maxWidth-full:"100%";--maxWidth-wrapper:var(--maxWidth-2xl);--spacing-px:"1px";--spacing-0:0;--spacing-1:0.25rem;--spacing-2:0.5rem;--spacing-3:0.75rem;--spacing-4:1rem;--spacing-5:1.25rem;--spacing-6:1.5rem;--spacing-8:2rem;--spacing-10:2.5rem;--spacing-12:3rem;--spacing-16:4rem;--spacing-20:5rem;--spacing-24:6rem;--spacing-32:8rem;--fontFamily-sans:Lato,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--fontFamily-serif:charter,Georgia,Cambria,"Times New Roman",Times,serif;--font-body:var(--fontFamily-serif);--font-heading:var(--fontFamily-sans);--fontWeight-normal:400;--fontWeight-medium:500;--fontWeight-semibold:600;--fontWeight-bold:700;--fontWeight-extrabold:800;--fontWeight-black:900;--fontSize-root:16px;--lineHeight-none:1;--lineHeight-tight:1.1;--lineHeight-normal:1.5;--lineHeight-relaxed:32px;--fontSize-0:0.833rem;--fontSize-1:1rem;--fontSize-2:1.2rem;--fontSize-3:21px;--fontSize-4:1.728rem;--fontSize-5:2.074rem;--fontSize-6:2.488rem;--fontSize-7:2.986rem;--blog-width:680px}*,:after,:before{box-sizing:border-box}html{line-height:var(--lineHeight-normal);font-size:var(--fontSize-root);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}html[data-color=dark]{--color-background:#1b262c;--color-primary:#8fd7ff;--color-secondary:#bcb7ae;--color-text:#c6c1b9;--color-text-light:#aea79c;--color-heading:#d2cec8;--color-heading-black:#e8e6e3;--color-accent:#d1dce5;--color-mode:#d1dce5;--color-fading:#9e9689;--color-post-snippet-background:#162125;--color-selection:#3e7080}html[data-color=light]{--color-background:#fff;--color-primary:#3eb0ef;--color-secondary:#3c484e;--color-text:#2e353f;--color-text-light:#4f5969;--color-heading:#1a202c;--color-mode:#1a202c;--color-heading-black:#000;--color-accent:#d1dce5;--color-fading:#757575;--color-post-snippet-background:#f9f9ff;--color-selection:#ffd3d3}body{font-family:var(--font-body);font-size:var(--fontSize-3);color:var(--color-text);background:var(--color-background);transition:all .35s ease}::selection{background:var(--color-selection)}::-moz-selection{background:var(--color-selection)}footer{padding:var(--spacing-5) var(--spacing-5);display:flex;justify-content:space-between;max-width:var(--maxWidth-5xl);margin:auto}.footer-copyright{font-size:14px;font-family:var(--fontFamily-sans)}.footer-social>*{margin:0 10px;font-size:20px}.more-articles{margin:calc(var(--spacing-8)/2) 0}.more-articles>a{text-decoration:none!important;color:var(--color-primary);padding:10px 20px;border-radius:50px}.toggle-dark-light{appearance:none;-webkit-appearance:none;border:none;background:none;color:var(--color-mode);font-size:40px;cursor:pointer;padding:0}hr{background:var(--color-accent);height:1px;border:0}h1,h2,h3,h4,h5,h6{font-family:var(--font-heading);margin-top:var(--spacing-12);margin-bottom:var(--spacing-6);line-height:var(--lineHeight-tight);letter-spacing:-.025em}h2,h3,h4,h5,h6{font-weight:var(--fontWeight-bold);color:var(--color-heading)}h1{font-weight:var(--fontWeight-black);font-size:var(--fontSize-6);color:var(--color-heading-black)}h2{font-size:var(--fontSize-5)}h3{font-size:var(--fontSize-4)}h4{font-size:var(--fontSize-3)}h5{font-size:var(--fontSize-2)}h6{font-size:var(--fontSize-1)}h1>a,h2>a,h3>a,h4>a,h5>a,h6>a{color:inherit;text-decoration:none}p{line-height:var(--lineHeight-relaxed);--baseline-multiplier:0.179;--x-height-multiplier:0.35;margin:var(--spacing-0) var(--spacing-0) var(--spacing-8) var(--spacing-0)}ol,p,ul{padding:var(--spacing-0)}ol,ul{margin-left:var(--spacing-0);margin-right:var(--spacing-0);margin-bottom:var(--spacing-8);list-style-position:outside;list-style-image:none}ol li,ul li{padding-left:var(--spacing-0)}li>p,ol li,ul li{margin-bottom:calc(var(--spacing-8)/2)}li :last-child{margin-bottom:var(--spacing-0)}li>ul{margin-left:var(--spacing-8);margin-top:calc(var(--spacing-8)/2)}blockquote{color:var(--color-text-light);margin-left:calc(var(--spacing-6)*-1);margin-right:var(--spacing-8);padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-6);border-left:var(--spacing-1) solid var(--color-primary);font-size:var(--fontSize-2);font-style:italic;margin-bottom:var(--spacing-8)}blockquote>:last-child{margin-bottom:var(--spacing-0)}blockquote>ol,blockquote>ul{list-style-position:inside}table{width:100%;margin-bottom:var(--spacing-8);border-collapse:collapse;border-spacing:.25rem}table thead tr th{border-bottom:1px solid var(--color-accent)}a{color:var(--color-primary)}a:focus,a:hover{text-decoration:none}.global-wrapper{margin:var(--spacing-0) auto;padding:var(--spacing-5) var(--spacing-5);max-width:var(--maxWidth-5xl)}.global-wrapper[data-is-root-path=true] .bio{margin-bottom:var(--spacing-20)}.global-header{margin-bottom:var(--spacing-12)}.main-heading{font-size:var(--fontSize-7);margin:0}.post-list-wrapper{padding:20px;border:1px solid #e7e7e7;border-radius:5px;margin-bottom:0;background:var(--color-post-snippet-background)}.post-list-item p{margin-bottom:var(--spacing-0);font-size:var(--fontSize-2)}.post-list-item h2{font-size:var(--fontSize-4);color:var(--color-primary);margin-bottom:var(--spacing-2);margin-top:var(--spacing-0)}.post-list-item small{font-size:var(--fontSize-1);color:#8a8a8a}.post-list-item header{margin-bottom:var(--spacing-4)}.no-posts-found{font-size:var(--fontSize-2);font-family:var(--fontFamily-sans);color:var(--color-fading);display:block;text-align:center;padding:130px 20px}.no-posts-found>span{font-size:80px;display:block}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration,input[type=search]::-webkit-search-results-button,input[type=search]::-webkit-search-results-decoration{-webkit-appearance:none}.header-link-home{font-weight:var(--fontWeight-black);font-family:var(--font-heading);text-decoration:none;font-size:var(--fontSize-4);color:var(--color-heading-black)}.bio{text-align:center;margin-bottom:var(--spacing-10)}.bio h1{margin-top:20px}.bio p{font-family:var(--fontFamily-sans)}.bio-avatar,.bio p{margin-bottom:var(--spacing-0)}.bio-avatar{margin-right:var(--spacing-4);min-width:200px;border-radius:100%}.blog-post header h1{margin:var(--spacing-0) auto var(--spacing-4) auto;max-width:var(--blog-width)}.blog-post section h1,.blog-post section h2,.blog-post ul,ol{margin-left:auto;margin-right:auto;max-width:var(--blog-width)}.blog-post .iframe-wrapper{width:var(--blog-width);margin:auto}.blog-post header p,.date-header{font-size:var(--fontSize-2);font-family:var(--font-heading)}.blog-post-nav ul{margin:var(--spacing-0)}.blog-post blockquote,.blog-post p{max-width:var(--blog-width);margin-right:auto;margin-left:auto}.blog-post a:hover{color:var(--color-primary);text-decoration:none}.blog-post a{color:var(--color-secondary);box-shadow:inset 0 -1px 0 var(--color-primary);text-decoration:none}.blog-post code[class*=language-],.gatsby-highlight{font-size:var(--fontSize-1)}.gatsby-highlight{max-width:var(--blog-width);margin-bottom:var(--spacing-8);margin-right:auto;margin-left:auto}@media (max-width:42rem){blockquote{padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-4);margin-left:var(--spacing-0)}ol,ul{list-style-position:inside}}.gatsby-resp-image-figcaption{font-size:14px;font-family:sohne,Helvetica Neue,Helvetica,Arial,sans-serif;line-height:20px;color:var(--color-fading);margin-top:20px;text-align:center}.gatsby-resp-image-figure{margin:0}.header-image{max-width:inherit!important}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.32.11"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=58d69f589aada9820ecd68f822139fcf" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#3eb0ef"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=58d69f589aada9820ecd68f822139fcf"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=58d69f589aada9820ecd68f822139fcf"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=58d69f589aada9820ecd68f822139fcf"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=58d69f589aada9820ecd68f822139fcf"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=58d69f589aada9820ecd68f822139fcf"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=58d69f589aada9820ecd68f822139fcf"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=58d69f589aada9820ecd68f822139fcf"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=58d69f589aada9820ecd68f822139fcf"/><title data-react-helmet="true">Simple Cache Decorator for Webapps that self-invalidates | Yasser Codes</title><meta data-react-helmet="true" name="description" content="When building a product that is constantly growing in terms of usage and features, it is sometimes tough to stop and optimize your code to take up less queries/memory/processing power/magic. Here at…"/><meta data-react-helmet="true" property="og:title" content="Simple Cache Decorator for Webapps that self-invalidates"/><meta data-react-helmet="true" property="og:description" content="When building a product that is constantly growing in terms of usage and features, it is sometimes tough to stop and optimize your code to take up less queries/memory/processing power/magic. Here at…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="ysr.sayed"/><meta data-react-helmet="true" name="twitter:title" content="Simple Cache Decorator for Webapps that self-invalidates"/><meta data-react-helmet="true" name="twitter:description" content="When building a product that is constantly growing in terms of usage and features, it is sometimes tough to stop and optimize your code to take up less queries/memory/processing power/magic. Here at…"/><link as="script" rel="preload" href="/webpack-runtime-33d44321a0a81df8b949.js"/><link as="script" rel="preload" href="/framework-741ade27086b2708e961.js"/><link as="script" rel="preload" href="/styles-55e82d6ff5158c00b714.js"/><link as="script" rel="preload" href="/app-801afe0d10777c06f0c2.js"/><link as="script" rel="preload" href="/cb1608f2-58530106a92d01a3ac1b.js"/><link as="script" rel="preload" href="/a9a7754c-3e74a2f80416cf348e88.js"/><link as="script" rel="preload" href="/commons-9f816676065765e4e536.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-d84d3c98a032bf8c6c37.js"/><link as="fetch" rel="preload" href="/page-data/cache-decorator/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2841359383.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><nav style="padding:20px 30px;display:flex;justify-content:space-between"><a class="header-link-home" href="/">Yasser Codes</a><button class="toggle-dark-light"> <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="moon" class="svg-inline--fa fa-moon fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 0 0 283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"></path></svg> </button></nav><div class="global-wrapper"><main><article class="blog-post" itemscope="" itemType="http://schema.org/Article"><header><h1 itemProp="headline">Simple Cache Decorator for Webapps that self-invalidates</h1><p>June 21, 2018</p></header><section itemProp="articleBody"><p>When building a product that is constantly growing in terms of usage and features, it is sometimes tough to stop and optimize your code to take up less queries/memory/processing power/magic. Here at <a href="https://meddy.co">Meddy</a> we’re a relatively small team handling a relatively large codebase and userbase. This leads us to having speed issues on some of our pages and very little time to solve those issues. In this particular case, we were having problems with our Listings Page. Here’s how it looks:</p>
<p><figure class="gatsby-resp-image-figure" style="">
    <span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/69e388e64b3325a6d7f6a752065a03dc/21de8/1*o4RTcjZ3o7QG0x_l-NL5tg.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 72.94117647058825%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAACnklEQVQoz1VT22oUQRCdv/AP/BPxAopPovjmg6IExLzlzR8IIr6JIGI0SDSSh3jDiDEhgWAwWZPdTXaz2exk55a57cx093R3dY/Vk0SxONRUX2bq1KkaKxuN8iyrTk0phUuQ8u+OlEJwfhzrGseBqioro5ThudZcqRKgFFBQkRHOOBiUUHKdE55TDlxUuGBlxbkgjKTE2o/ibhD2wggDpyB2SAYetQM68AniwCu6dtIdxH2POh0/bg6SncOkbcdtm/Uci1CZFZIxiVS1VFoZVNpAaxMD4JFAx5AUh4wJ9EQoJrUVR7HrOoSWBCmZmrUEJaRGANSf0sYLCVgoHdih6/eHMWESr1qtjbXFudeR7bn9QUEJilFymWYszVEKJbRKOCcSDfCIJWnsha4dJDkTKFiR50kYolSEUs55nQdOYUwCYCQoxbRpZ2/U6eYFmX/37cuTV1gzSZIgT3GHGtpag3kByRu2UC8NpPTccHdvGATxx7WdxtR0ND5htfu9pdXleOg5Azsvin+0s/9om+SqOspkkDA3pEXBKwALG0tRHlaWrJRwQrUW6iTGJzKKAr+1vhoERxx03x4uray1O13LP9jfXvlOh35y6JRmkjQXgFOBn6o09k6Rerw+zM6cO3um2dgIhgePHz64cPHSvbH7lt/bay//KARP8xxF0RVWC2XJ63wVjl3MKAYLc28nr5/vdXZbmz9fTNy+evnKnbtjVpZlYRxJPyyPYjBSY5NBSOPlMXEwTdrZak1NPtre6Tx/+ebp+K0b127OzM5bzcavz++nszgJXA8z4z2c7SDGqZFam8wRClhVmy1n8tni3EJjfWOrufV7+eunQ8fDVlHP9UohGI67EHBqdUpMDriFLDi2IOfDoEgLSIkaUfML/QGqTT0BntLflAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="How our listings page looks"
        title="How our listings page looks"
        src="/static/69e388e64b3325a6d7f6a752065a03dc/c5bb3/1*o4RTcjZ3o7QG0x_l-NL5tg.png"
        srcset="/static/69e388e64b3325a6d7f6a752065a03dc/04472/1*o4RTcjZ3o7QG0x_l-NL5tg.png 170w,
/static/69e388e64b3325a6d7f6a752065a03dc/9f933/1*o4RTcjZ3o7QG0x_l-NL5tg.png 340w,
/static/69e388e64b3325a6d7f6a752065a03dc/c5bb3/1*o4RTcjZ3o7QG0x_l-NL5tg.png 680w,
/static/69e388e64b3325a6d7f6a752065a03dc/b12f7/1*o4RTcjZ3o7QG0x_l-NL5tg.png 1020w,
/static/69e388e64b3325a6d7f6a752065a03dc/b5a09/1*o4RTcjZ3o7QG0x_l-NL5tg.png 1360w,
/static/69e388e64b3325a6d7f6a752065a03dc/21de8/1*o4RTcjZ3o7QG0x_l-NL5tg.png 2436w"
        sizes="(max-width: 680px) 100vw, 680px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span>
    <figcaption class="gatsby-resp-image-figcaption">How our listings page looks</figcaption>
  </figure></p>
<p>If you’re having application speed issues and you’re basically alone when trying to concoct a solution, then this post will help you utilize a relatively simple caching mechanism.</p>
<h2>!Small Disclaimer!</h2>
<p>The code that you will see in this post is Python code and utilizes the Django Framework. Don’t be disparaged as I will be explaining the concepts and it should be easily recoded in any other language/framework.</p>
<h1>Caching and Cache Invalidation</h1>
<h2>Why Cache?</h2>
<p>Caching is pretty f*<em>\</em>ing awesome! Most of your optimizations should be done by optimizing a caching layer. In fact, if a cache doesn’t help you optimize further then your codebase is probably already very mature and you’re looking for very low level optimizations. In the book <a href="https://highperformancedjango.com/">High Performance Django</a>, authors Peter Baumgartner and Yann Malet say:</p>
<blockquote>
<p>Serving the entire HTTP response directly out of cache is ideal. When it isn’t possible, as many parts of the response as possible should come from cache.</p>
</blockquote>
<p>In a sense you should milk everything out of your cache cow before thinking of more complex optimization.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/ce027aa0f4119c1aeafbdcb61df24cc3/4b190/1*ouvtvjJowhxbUoI7C0MOkQ.jpg"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 55.88235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQBAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB1l3IgLSv/8QAHBAAAQMFAAAAAAAAAAAAAAAAAgABEhETISIx/9oACAEBAAEFAicpXdwfBdi1V//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAECAQE/Aaf/xAAYEAACAwAAAAAAAAAAAAAAAAAAEBExYf/aAAgBAQAGPwLCHS//xAAZEAADAQEBAAAAAAAAAAAAAAAAAREhMVH/2gAIAQEAAT8hQ6nstat3Bj7olhi3xRH/2gAMAwEAAgADAAAAEIsP/8QAFREBAQAAAAAAAAAAAAAAAAAAEEH/2gAIAQMBAT8Qh//EABURAQEAAAAAAAAAAAAAAAAAABAx/9oACAECAQE/EKP/xAAbEAEBAAMAAwAAAAAAAAAAAAABEQAhMUFRgf/aAAgBAQABPxB8QnvzBx8ghfuvGVSoZbcLuGtYeJAozCAhy5//2Q=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="1 ouvtvjJowhxbUoI7C0MOkQ"
        title="1 ouvtvjJowhxbUoI7C0MOkQ"
        src="/static/ce027aa0f4119c1aeafbdcb61df24cc3/7bf67/1*ouvtvjJowhxbUoI7C0MOkQ.jpg"
        srcset="/static/ce027aa0f4119c1aeafbdcb61df24cc3/651be/1*ouvtvjJowhxbUoI7C0MOkQ.jpg 170w,
/static/ce027aa0f4119c1aeafbdcb61df24cc3/d30a3/1*ouvtvjJowhxbUoI7C0MOkQ.jpg 340w,
/static/ce027aa0f4119c1aeafbdcb61df24cc3/7bf67/1*ouvtvjJowhxbUoI7C0MOkQ.jpg 680w,
/static/ce027aa0f4119c1aeafbdcb61df24cc3/4b190/1*ouvtvjJowhxbUoI7C0MOkQ.jpg 800w"
        sizes="(max-width: 680px) 100vw, 680px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<h2>Test payoff of a Cache</h2>
<p>In the setting of an application, having an in-memory cache that stores queries going to-and-for the database can have massive pay off. However it’s important to run a line profiler before and after a simple cache to see if it’s worth adding a cache or not. To test this out, I’ve ran some parts of my code on a debug server and ran a line profiler to see where the weak points are and then added a simple cache to see if it would help at all.</p>
<div class="iframe-wrapper">
    <iframe
        width="100%"
        height="1230px"
        frameborder="0"
        scrolling="no"
        id="sizetracker"
        src="data:text/html;charset=utf-8,
        <head><base target='_blank' /></head>
        <body><script src='https://gist.github.com/yelsayed/20dce842b4d969ed53107bcde71f06e9.js'></script>
        </body>"></iframe>
</div>
<p>You can find this line profiler tool <a href="https://github.com/rkern/line_profiler">here</a>. It’s an amazing piece of software written by Robert Kern.</p>
<p>I’m sorry if the gist above is half cut but the right side doesn’t matter, it’s all about the left side. I’ve profiled two functions, the second renders the page and the first one just returns meta tags for this specific page (title, meta… etc.). As you can see, the total time is 2.7 seconds (this is expected to be faster on the production server but it’s still pretty darn slow!).</p>
<p>If we do a quick analysis we see that there a couple functions being called that end up taking the bulk of the time. If we reduce the speed of these functions then it would massively decrease the overall time of the page!</p>
<h2>Simple Fix time!</h2>
<p>If we just cache the output of these functions, we would see the potential of having a cache layer, so let’s try it out. I’m using <a href="https://redis.io/">Redis</a> for in-memory cache. For most web application frameworks, integration with Redis is pretty simple and I will not go through it in this post. We can abstract the use of a cache through the following interface:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token comment"># Gets the value assigned to key `key`</span>
cache<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token comment"># Sets the value to key `key`</span></code></pre></div>
<p>Cool! So now let’s wrap our heavy functions with this cache, meaning we’ll do pretty much the following for our functions</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">heavy_function</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>  
    cached <span class="token operator">=</span> cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span>  
    <span class="token keyword">if</span> cached<span class="token punctuation">:</span>  
        <span class="token keyword">return</span> cached  
      
    <span class="token comment"># ...  </span>
    <span class="token comment"># Execute normally for this function  </span>
    <span class="token comment"># ...  </span>
      
    cache<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> result_of_execution<span class="token punctuation">)</span>  
    <span class="token keyword">return</span> result_of_execution</code></pre></div>
<p>Once we do this for our big functions, we suddenly have this report from our profiler.</p>
<div class="iframe-wrapper">
    <iframe
        width="100%"
        height="1230px"
        frameborder="0"
        scrolling="no"
        id="sizetracker"
        src="data:text/html;charset=utf-8,
        <head><base target='_blank' /></head>
        <body><script src='https://gist.github.com/yelsayed/e45669c506a6b3c435842345d0da1287.js'></script>
        </body>"></iframe>
</div>
<p>As you can see just by adding a simple cache the speed of the code went down by ~2 seconds! This is a great start but there is a big problem now, <strong>Cache Invalidation.</strong></p>
<h2>Cache Invalidation</h2>
<p>If you refresh your page after this step you should see (or at least feel) that your page is faster, but if you try and change the data in your test DB you’ll realize that it’s not being updated. This problem is commonly referred to as <a href="https://en.wikipedia.org/wiki/Cache_invalidation">Cache Invalidation</a>. We need to find a way to invalidate our cache when the values of our functions are updated.</p>
<blockquote>
<p><em>There are only two hard things in Computer Science: cache invalidation and naming things.</em></p>
<p><em>— Phil Karlton</em></p>
</blockquote>
<p>Initially, I had two ways I can go about this. The first one was to update the cache of a certain method/function whenever an entry in the DB is updated (since most of the heavy functions are calls to the database). The second one was to update the result of a function whenever the output is different for the same parameters. Let’s do a quick analysis on both and why I chose the latter.</p>
<h2>First method</h2>
<p>Having it such that we update the cache for a method/function whenever an entry in the database happens is difficult to code, not very reproducible, and more often than not will result in spaghetti code. If you’re like me and you have a large amount of tables you need to query in a single function, it’s going to be messy to update that function’s cache whenever an entry is made for that database. Let me draw you a little picture.</p>
<p><figure class="gatsby-resp-image-figure" style="">
    <span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/bec3efbdb61025c287363bb1241ce728/a2ef2/1*mQOXz83PeEigmilq9Q2xZA.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 51.17647058823529%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABTUlEQVQoz5WR606DQBCFef+HMP7QxPgUxgSx0CZtKVRK5aaFlnK3C+yNdZdLNDEm+oVkGZYzc2ZGYoxRyrqOPyOU0u4bQ8Qm+KubXKzTR4OoNH36uv6NIVMN0f08uJ15fgqEODqyvOiKPMnSPI7jJDnH8TmKIgDqNE2DICjLkgsxxlzcIvxoxw9WfCwbIQ6PnWWfNvp6vdZNw1CeFFVVZVkuyjIKQ8dxqqoSyt4dxPROC64VN8hqqfdDt6axXK5Mw3zd7xXleb5YmKaBCRk6JoRggTjqFqpuqrnJWJn/kGU59wa4UQDKSgAuoBdghBCZ4CEfJ6ibrKh40rHyztptty+e5x0Ooa5vbHunaVrOJ9G3SieGaYdF42eA+x+nPSRGELYtFAUQEpq+yWF5EwQ08GbmX8mOlwCJ/RNE6PItX71n50sr/Vgm+8PC2WDqE/N+OyVeMTAQAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Little representation of a function that access the database"
        title="Little representation of a function that access the database"
        src="/static/bec3efbdb61025c287363bb1241ce728/c5bb3/1*mQOXz83PeEigmilq9Q2xZA.png"
        srcset="/static/bec3efbdb61025c287363bb1241ce728/04472/1*mQOXz83PeEigmilq9Q2xZA.png 170w,
/static/bec3efbdb61025c287363bb1241ce728/9f933/1*mQOXz83PeEigmilq9Q2xZA.png 340w,
/static/bec3efbdb61025c287363bb1241ce728/c5bb3/1*mQOXz83PeEigmilq9Q2xZA.png 680w,
/static/bec3efbdb61025c287363bb1241ce728/b12f7/1*mQOXz83PeEigmilq9Q2xZA.png 1020w,
/static/bec3efbdb61025c287363bb1241ce728/b5a09/1*mQOXz83PeEigmilq9Q2xZA.png 1360w,
/static/bec3efbdb61025c287363bb1241ce728/a2ef2/1*mQOXz83PeEigmilq9Q2xZA.png 1970w"
        sizes="(max-width: 680px) 100vw, 680px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span>
    <figcaption class="gatsby-resp-image-figcaption">Little representation of a function that access the database</figcaption>
  </figure></p>
<p>If you’re using an MVVC framework you probably have a model in your code that controls all accesses to your database. So you might think that it wouldn’t be so bad if we just cache and invalidate at the lowest level of our models. For example, if you call <strong>model_1</strong> to access <strong>table_1</strong> and a change happens in a row of <strong>model_1</strong> then you can just invalidate the cache by writing a function for <strong>model_1</strong>. But remember that accessing the database isn’t just one function and you can do it in many different ways, you’ll end up splitting your code into tiny little pieces and lose track of what keys in the cache you have to invalidate. It’s also an absolute nightmare to debug (learnt that the hard way).</p>
<h2><strong>Second Method</strong></h2>
<p>Second method is a lot more general and doesn’t just apply to access in the database, rather to everything (such as static helper methods). There is a Python module called <a href="https://docs.python.org/3/library/functools.html">functools</a> which has a decorator called <strong>lru_cache</strong> (the LRU here stands for least recently used, you can read about the concept more <a href="https://en.wikipedia.org/wiki/Cache_replacement_policies#Least_recently_used_(LRU)">here</a>). By using the <strong>lru_cache</strong> on a function it stores the outputs based on the input and caches the results in memory. Here is a small profiling of fibonacci function one with <strong>lru_cache</strong> applied and one without (n=32).</p>
<div class="iframe-wrapper">
    <iframe
        width="100%"
        height="780px"
        frameborder="0"
        scrolling="no"
        id="sizetracker"
        src="data:text/html;charset=utf-8,
        <head><base target='_blank' /></head>
        <body><script src='https://gist.github.com/yelsayed/491a5ae9bbd0e3d3a0e453349268e3e9.js'></script>
        </body>"></iframe>
</div>
<p>There is only one issue, this cache is not global, if you want to use it properly then it should be used within the same thread being executed. So for our method to work we just need to have our own global implementation of <strong>lru_cache</strong>.</p>
<h2>Implementation</h2>
<p>Thankfully, redis is a server running locally that stores values very much in the same way as <strong>lru_cache</strong> does. So what I did was look into the source code for <strong>lru_cache</strong> and just rewrite it as necessary.</p>
<p>There are three main parts, key generation, cache update and cache retrieval.</p>
<h2>Key Generation</h2>
<p>In the code for the <strong>lru_cache</strong>, it generates a certain hash from the parameters passed into the function.</p>
<p>It’s important to note that this assumes that if you give your function params x,y,z then the output should always be the same whenever x,y,z is passed in.</p>
<p>That key is used to store the output of the function in the Redis cache. On paper it looks something like this.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">return_value <span class="token operator">=</span> func<span class="token punctuation">(</span><span class="token operator">**</span>params<span class="token punctuation">)</span>
key <span class="token operator">=</span> generate_key<span class="token punctuation">(</span><span class="token operator">**</span>params<span class="token punctuation">)</span>
cache<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> return_value<span class="token punctuation">)</span>  
<span class="token keyword">return</span> return_value</code></pre></div>
<p>Now let’s code the generate_key function.</p>
<div class="iframe-wrapper">
    <iframe
        width="100%"
        height="750px"
        frameborder="0"
        scrolling="no"
        id="sizetracker"
        src="data:text/html;charset=utf-8,
        <head><base target='_blank' /></head>
        <body><script src='https://gist.github.com/yelsayed/c3585e3029bc3b52cf190e9e9b3d78c0.js'></script>
        </body>"></iframe>
</div>
<h2>Cache Update</h2>
<p>For the cache update, it’s quite simple. All we have to do is get the old result from the cache and the new result from the cache, if they’re unequal, then just update the cache. On paper, here’s how it will look like:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">new_result <span class="token operator">=</span> func<span class="token punctuation">(</span><span class="token operator">**</span>params<span class="token punctuation">)</span>
old_result <span class="token operator">=</span> cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span>  
<span class="token keyword">if</span> new_result <span class="token operator">!=</span> old_result<span class="token punctuation">:</span>  
    cache<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>cache_key<span class="token punctuation">,</span> new_result<span class="token punctuation">)</span></code></pre></div>
<p>This is exactly how the code will look like.</p>
<div class="iframe-wrapper">
    <iframe
        width="100%"
        height="370px"
        frameborder="0"
        scrolling="no"
        id="sizetracker"
        src="data:text/html;charset=utf-8,
        <head><base target='_blank' /></head>
        <body><script src='https://gist.github.com/yelsayed/4bfb7701a2598d7b7ef84556c53c5815.js'></script>
        </body>"></iframe>
</div>
<p>There is a bit of a problem with this though. If your execution thread has it such that the function is going to be called in its entirety then what’s the point of a cache? Right now the execution thread looks like this:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">call function -&gt; call cache_wrapper -&gt; get from cache -&gt; **check if cache is stale by calling function????**</code></pre></div>
<p>At some point we have to call the function to check if the cache is stale or not. But the entire point of a cache is to avoid calling the function!</p>
<p>A nice clean solution would be to update the cache in a separate thread by calling the function there. It doesn’t matter how long it would take to execute the function because it’s in a separate thread, so we good! Let’s see how that will look in the next section.</p>
<h2>Putting it all Together (Cache Retrieval)</h2>
<p>Now that we have our key and a way to update our stale (if any) cache, we can generate it every time the function is called and check Redis to see if something exists for it, and then finally call the elegant update function we created. Like always, on paper this looks like this:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">key <span class="token operator">=</span> generate_key<span class="token punctuation">(</span><span class="token operator">**</span>params<span class="token punctuation">)</span>  
result <span class="token operator">=</span> cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span>  
<span class="token keyword">if</span> result <span class="token operator">==</span> null<span class="token punctuation">:</span>  
    result <span class="token operator">=</span> func<span class="token punctuation">(</span><span class="token operator">**</span>params<span class="token punctuation">)</span>  
    cache<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> result<span class="token punctuation">)</span>  
<span class="token keyword">else</span><span class="token punctuation">:</span>  
    thread <span class="token operator">=</span> new_thread<span class="token punctuation">(</span>check_and_update_cache<span class="token punctuation">,</span> <span class="token operator">**</span>params<span class="token punctuation">)</span>  
    thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>  
<span class="token keyword">return</span> result</code></pre></div>
<p>In the above pseudocode, I open a new thread for the function that we created above to check and update the cache. Just as simple as that. Remember, we also need to make this into a decorator to make the lives of our developers easy. The final code should look like this:</p>
<div class="iframe-wrapper">
    <iframe
        width="100%"
        height="1030px"
        frameborder="0"
        scrolling="no"
        id="sizetracker"
        src="data:text/html;charset=utf-8,
        <head><base target='_blank' /></head>
        <body><script src='https://gist.github.com/yelsayed/01a088a78da0fb68980b2561d860417b.js'></script>
        </body>"></iframe>
</div>
<p>The last bit of code that may seem unfamiliar is the bit that makes our code into a usable decorator. If you want to understand more read <a href="https://realpython.com/primer-on-python-decorators/">this</a>.</p>
<h2>Downsides of this Approach</h2>
<p>Like with every approach there are some downsides to this approach. For one, opening too many threads doesn’t always have a good impact on speed. It depends on how many threads you open before it becomes too many threads. The question of how many threads is too many threads depends on your infrastructure, code, and <a href="https://stackoverflow.com/questions/481970/how-many-threads-is-too-many">measurements</a>. The simple solution here is to limit the number of threads you open by creating a <a href="https://en.wikipedia.org/wiki/Thread_pool">thread pool</a>.</p>
<p>Another downside is that if you think about it the data we serve is a little stale once it’s updated. Opening a new thread and updating while the main thread returns the result from a stale cache means that it’s returning the old result. This cache will obviously be updated once the thread finishes executing, and the user will get the updated result after using the function for a second time.</p>
<h1><a href="https://gist.github.com/yelsayed/bd35809d5a3f12adf1dfe9ef3b0e6b19">Here’s the full code</a></h1>
<p>Thanks for reading. If you have any questions leave them in the comments.</p></section><hr/></article><nav class="blog-post-nav"><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li class="more-articles"><a rel="prev" href="/launch-portfolio/"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="backward" class="svg-inline--fa fa-backward fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M11.5 280.6l192 160c20.6 17.2 52.5 2.8 52.5-24.6V96c0-27.4-31.9-41.8-52.5-24.6l-192 160c-15.3 12.8-15.3 36.4 0 49.2zm256 0l192 160c20.6 17.2 52.5 2.8 52.5-24.6V96c0-27.4-31.9-41.8-52.5-24.6l-192 160c-15.3 12.8-15.3 36.4 0 49.2z"></path></svg> <!-- -->How to Launch a Portfolio as a Student</a></li><li class="more-articles"><a rel="next" href="/english-to-arabic-better/">Translating your front end to Arabic, a better way<!-- --> <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="forward" class="svg-inline--fa fa-forward fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M500.5 231.4l-192-160C287.9 54.3 256 68.6 256 96v320c0 27.4 31.9 41.8 52.5 24.6l192-160c15.3-12.8 15.3-36.4 0-49.2zm-256 0l-192-160C31.9 54.3 0 68.6 0 96v320c0 27.4 31.9 41.8 52.5 24.6l192-160c15.3-12.8 15.3-36.4 0-49.2z"></path></svg></a></li></ul></nav></main></div><footer style="display:flex;justify-content:space-between"><span class="footer-copyright">© <!-- -->2021<!-- -->, Yasser Codes</span><span class="footer-social"><a href="mailto:ysr.sayed@gmail.com"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="envelope" class="svg-inline--fa fa-envelope fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path></svg></a><a href="https://twitter.com/ysr.sayed"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a href="https://theyasser.medium.com"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="medium" class="svg-inline--fa fa-medium fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 32v448h448V32H0zm372.2 106.1l-24 23c-2.1 1.6-3.1 4.2-2.7 6.7v169.3c-.4 2.6.6 5.2 2.7 6.7l23.5 23v5.1h-118V367l24.3-23.6c2.4-2.4 2.4-3.1 2.4-6.7V199.8l-67.6 171.6h-9.1L125 199.8v115c-.7 4.8 1 9.7 4.4 13.2l31.6 38.3v5.1H71.2v-5.1l31.6-38.3c3.4-3.5 4.9-8.4 4.1-13.2v-133c.4-3.7-1-7.3-3.8-9.8L75 138.1V133h87.3l67.4 148L289 133.1h83.2v5z"></path></svg></a><a href="https://instagram.com/yeyeyesser"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="instagram" class="svg-inline--fa fa-instagram fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"></path></svg></a></span></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-84887634-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/cache-decorator/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-fbac4ca513f017f32fb6.js"],"app":["/app-801afe0d10777c06f0c2.js"],"component---src-pages-404-js":["/component---src-pages-404-js-8cc43f656001670f765b.js"],"component---src-pages-index-js":["/component---src-pages-index-js-2fad7b2d115e4ef683f8.js"],"component---src-pages-using-typescript-tsx":["/component---src-pages-using-typescript-tsx-413029d3b43934e34a2c.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-d84d3c98a032bf8c6c37.js"]};/*]]>*/</script><script src="/polyfill-fbac4ca513f017f32fb6.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-d84d3c98a032bf8c6c37.js" async=""></script><script src="/commons-9f816676065765e4e536.js" async=""></script><script src="/a9a7754c-3e74a2f80416cf348e88.js" async=""></script><script src="/cb1608f2-58530106a92d01a3ac1b.js" async=""></script><script src="/app-801afe0d10777c06f0c2.js" async=""></script><script src="/styles-55e82d6ff5158c00b714.js" async=""></script><script src="/framework-741ade27086b2708e961.js" async=""></script><script src="/webpack-runtime-33d44321a0a81df8b949.js" async=""></script></body></html>